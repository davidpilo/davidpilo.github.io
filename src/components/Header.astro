---
---

<header class="site-header">
  <div class="header-left">
    <span id="prompt-clock">00:00:00</span>
    <span class="prompt-username">david-pilo</span>
    <div class="prompt-git">
      <span class="prompt-project">
        home ±
      </span>
      <span class="prompt-branch">
        |main <span>✗</span>|→
      </span>
    </div>

    <div id="prompt-cursor"></div>
  </div>

  <nav class="header-nav">
    <a href="#bio">Bio</a>
    <a href="#posts">Posts</a>
    <a href="#projects">Projects</a>
  </nav>

  <div class="header-right">
    <!--<span class="keybind-hint">
      <kbd>Ctrl+V</kbd>
      <span class="keybind-label">vim</span>
    </span>-->
    <button id="theme-toggle" class="toggle-btn" title="Toggle theme">
      <span class="toggle-label" id="theme-label">&#9617;&#9618;&#9619; DARK</span>
    </button>
    <!--<button id="vim-toggle" class="toggle-btn vim-btn" title="Toggle VIM mode">
      <span class="toggle-icon">&nu;</span>
      <span class="toggle-label">VIM</span>
    </button>-->
  </div>
</header>

<script>
  // Prompts
  const promptClock = document.querySelector('#prompt-clock');

  if (promptClock) {
    setInterval(() => {
      promptClock.innerText = new Intl.DateTimeFormat(undefined, {
        hour: 'numeric',
        minute: 'numeric',
        second: 'numeric',
        hour12: false
      }).format(new Date());
    }, 1000);
  }

  // Theme toggle
  const themeToggle = document.getElementById('theme-toggle')!;
  const themeLabel = document.getElementById('theme-label')!;

  function applyTheme(theme: string) {
    document.documentElement.setAttribute('data-theme', theme);
    themeLabel.innerHTML = theme === 'dark' ? '&#9617;&#9618;&#9619; DARK' : '&#9619;&#9618;&#9617; LIGHT';
    themeToggle.classList.toggle('active', theme === 'light');
  }

  const savedTheme = localStorage.getItem('theme') ?? 'light';
  applyTheme(savedTheme);

  themeToggle.addEventListener('click', () => {
    const current = document.documentElement.getAttribute('data-theme') ?? 'dark';
    const next = current === 'dark' ? 'light' : 'dark';
    localStorage.setItem('theme', next);
    applyTheme(next);
  });

  // VIM mode toggle: j/k to scroll
  const vimToggle = document.getElementById('vim-toggle')!;
  let vimMode = false;

  vimToggle.addEventListener('click', () => {
    vimMode = !vimMode;
    vimToggle.classList.toggle('active', vimMode);
  });

  document.addEventListener('keydown', (e) => {
    if (e.ctrlKey && e.key === 'V') {
      e.preventDefault();
      vimMode = !vimMode;
      vimToggle.classList.toggle('active', vimMode);
      return;
    }

    if (!vimMode) return;

    const tag = (e.target as HTMLElement).tagName;

    if (tag === 'INPUT' || tag === 'TEXTAREA') return;
    if (e.key === 'j') window.scrollBy({ top: 60, behavior: 'smooth' });
    if (e.key === 'k') window.scrollBy({ top: -60, behavior: 'smooth' });
    if (e.key === 'g' && !e.shiftKey) window.scrollTo({ top: 0, behavior: 'smooth' });
    if (e.key === 'G') window.scrollTo({ top: document.body.scrollHeight, behavior: 'smooth' });
  });
</script>

<style is:global>
  :root,
  [data-theme="dark"] {
    --header-bg: var(--moonfly-bg);
    --header-border: var(--moonfly-grey18);
    --header-prompt-clock: var(--moonfly-blue);
    --header-prompt-user: var(--moonfly-grey62);
    --header-prompt-branch: var(--moonfly-green);
    --header-prompt-dirty: var(--moonfly-red);
    --header-prompt-project: var(--moonfly-turquoise);
    --header-prompt-cursor: var(--moonfly-green);
    --header-nav-color: var(--moonfly-grey70);
    --header-nav-hover: var(--moonfly-white);
    --header-hint-color: var(--moonfly-grey39);
    --header-kbd-bg: var(--moonfly-grey18);
    --header-kbd-border: var(--moonfly-grey30);
    --header-kbd-color: var(--moonfly-orange);
    --header-btn-bg: var(--moonfly-grey18);
    --header-btn-border: var(--moonfly-grey30);
    --header-btn-color: var(--moonfly-grey70);
    --header-btn-hover-bg: var(--moonfly-grey23);
    --header-btn-hover-fg: var(--moonfly-white);
    --header-btn-active: var(--moonfly-sky);
    --header-vim-btn-active: var(--moonfly-green);
  }

  [data-theme="light"] {
    --header-bg: var(--solarized-bg);
    --header-border: var(--solarized-selection);
    --header-prompt-clock: var(--solarized-blue);
    --header-prompt-user: var(--solarized-base1);
    --header-prompt-branch: var(--solarized-green);
    --header-prompt-dirty: var(--solarized-red);
    --header-prompt-project: var(--solarized-cyan);
    --header-prompt-cursor: var(--solarized-base1);
    --header-nav-color: var(--solarized-fg);
    --header-nav-hover: var(--solarized-blue);
    --header-hint-color: var(--solarized-base1);
    --header-kbd-bg: var(--solarized-selection);
    --header-kbd-border: var(--solarized-border);
    --header-kbd-color: var(--solarized-yellow);
    --header-btn-bg: var(--solarized-selection);
    --header-btn-border: var(--solarized-border);
    --header-btn-color: var(--solarized-fg);
    --header-btn-hover-bg: var(--solarized-hover);
    --header-btn-hover-fg: var(--solarized-fg);
    --header-btn-active: var(--solarized-blue);
    --header-vim-btn-active: var(--solarized-green);
  }
</style>

<style>
  .site-header {
    align-items: center;
    background-color: var(--header-bg);
    border-bottom: 1px solid var(--header-border);
    display: flex;
    font-size: 0.89rem;
    height: 4rem;
    justify-content: space-between;
    padding: 0rem 1.25rem;
    position: sticky;
    top: 0;
    z-index: 100;
  }

  .header-left {
    align-items: center;
    display: flex;
    font-weight: 700;
    gap: 0.5rem;
    white-space: nowrap;
  }

  #prompt-clock {
    color: var(--header-prompt-clock);
  }

  .prompt-username {
    color: var(--header-prompt-user);
  }

  .prompt-git {
    display: flex;
  }

  .prompt-project {
    color: var(--header-prompt-project);
  }

  .prompt-branch {
    color: var(--header-prompt-branch);
  }

  .prompt-branch > span {
    color: var(--header-prompt-dirty);
  }

  #prompt-cursor {
    animation: blink 1s step-start infinite;
    background-color: var(--header-prompt-cursor);
    height: 1rem;
    width: 0.5rem;
  }

  @keyframes blink {
    0%, 100% { opacity: 1; }
    50%       { opacity: 0; }
  }

  nav {
    align-items: center;
    display: flex;
    gap: 2rem;
    left: 50%;
    position: absolute;
    transform: translateX(-50%);
  }

  nav a {
    color: var(--header-nav-color);
    text-decoration: none;
    transition: color 0.15s;
  }

  nav a:hover {
    color: var(--header-nav-hover);
  }

  .header-right {
    align-items: center;
    display: flex;
    gap: 0.75rem;
    white-space: nowrap;
  }

  .keybind-hint {
    align-items: center;
    color: var(--header-hint-color);
    display: flex;
    gap: 0.35rem;
  }

  kbd {
    background-color: var(--header-kbd-bg);
    border: 1px solid var(--header-kbd-border);
    color: var(--header-kbd-color);
    font-family: inherit;
    line-height: 1.4;
    padding: 0.3rem 0.35rem;
  }

  .keybind-label {
    color: var(--header-hint-color);
  }

  .toggle-btn {
    align-items: center;
    background: var(--header-btn-bg);
    border: 1px solid var(--header-btn-border);
    color: var(--header-btn-color);
    cursor: pointer;
    display: flex;
    font-size: 0.8rem;
    gap: 0.3rem;
    letter-spacing: 0.03em;
    padding: 0.35rem 0.5rem;
    transition: background 0.15s, color 0.15s;
  }

  .toggle-btn:hover {
    background: var(--header-btn-hover-bg);
    color: var(--header-btn-hover-fg);
  }

  .toggle-btn.active {
    background: var(--header-btn-hover-bg);
    border-color: var(--header-btn-active);
    color: var(--header-btn-active);
  }

  .toggle-btn.vim-btn.active {
    border-color: var(--header-vim-btn-active);
    color: var(--header-vim-btn-active);
  }

  @media (max-width: 1199px) {
    nav {
      display: none;
    }
  }

  @media (max-width: 679px) {
    .site-header {
      display: none;
    }
  }
</style>
